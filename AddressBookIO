package org.example;

import java.io.*;
import java.util.*;

 class Main {
    private static Scanner in = new Scanner(System.in);
    private static File file = new File("Addresses.txt");
    static List<Person> people = new ArrayList<>();

    public static void main(String[] args) throws IOException {
        readPeopleFromFile();
        writePeopleFromFile();
        showMainMenu();
    }

    private static void findPerson() throws IOException {
        System.out.println("1. Find with name");
        System.out.println("2. Find with surname");

        String choice;
        do {
            choice = in.nextLine();
            switch (choice) {
                case "1":
                    findByName();
                    break;
                case "2":
                    findBySurname();
                    break;
                default:
                    System.out.print("Choose 1 or 2: ");
            }
        } while (!choice.equals("1") && !choice.equals("2"));
        System.out.println();
        showMainMenu();
    }

    private static void findBySurname() {
        System.out.print("Enter surname: ");
        String surnameToFind = in.nextLine();
        int matches = 0;
        for(Person person : people) {
            if(person.getSurname().equals(surnameToFind)) {
                System.out.println(person);
                matches++;
            }
        }
        if(matches<=0) {
            System.out.println("There is no person with this surname");
        }
    }

    private static void findByName() {
        System.out.print("Enter name: ");
        String nameToFind = in.nextLine();
        int matches = 0;
        for(Person person : people) {
            if(person.getName().equals(nameToFind)) {
                System.out.println(person);
                matches++;
            }
        }
        if(matches<=0) {
            System.out.println("There is no person with this name ");
        }
    }

    private static void addPerson() throws IOException {

        System.out.println("Enter First name: ");
        String fname = in.nextLine();
        System.out.println("Enter Surname: ");
        String lname = in.nextLine();
        System.out.println("Enter phone number: ");
        String mobNumber = in.nextLine();
        System.out.println("Enter email: ");
        String email = in.nextLine();
        System.out.println("Enter address: ");
        String address = in.nextLine();
        System.out.println("Enter State: ");
        String state = in.nextLine();
        System.out.println("Enter City: ");
        String city = in.nextLine();
        System.out.println("Enter Zip Code: ");
        String zip = in.nextLine();

        Person person = new Person(fname, lname, mobNumber, email, address, state, city, zip);
        addToFile(person);
        people.add(person);
        int id = Main.people.size();
        System.out.println("Added person number: " + id + person);
        System.out.println();
        showMainMenu();
    }

    private static void addToFile(Person person) {
        try(BufferedWriter writer = new BufferedWriter(new FileWriter(file, true))) {
            writer.write(person.getName()+"\r\n" + person.getSurname() + "\r\n" + person.getMobNumber() + "\r\n" + person.getEmail() +
                    "\r\n" + person.getAddress()+ "\r\n" + person.getCity()+"\r\n"+person.getState()+"\r\n"+person.getZip()+"\r\n\r\n");
        } catch(IOException e) {
            System.out.println(e);
        }
    }

    private static boolean readPeopleFromFile() throws IOException {
        try(BufferedReader reader = new BufferedReader(new FileReader(file))) {
            String name = null;
            while((name = reader.readLine()) != null) {
                Person person = new Person(name, reader.readLine(), reader.readLine(), reader.readLine(), reader.readLine(),reader.readLine(),reader.readLine(),reader.readLine());
                people.add(person);        //adds person to the list
                reader.readLine();
            }
            return true;
        }
        catch ( IOException e) {
            System.out.println(e);
        }
        return false;
    }
    //

     private static void writePeopleFromFile() throws IOException {
         try {
             FileWriter myWriter = new FileWriter("Addresses.txt");
             myWriter.write("Welcome to Address Book!");
             myWriter.close();
             System.out.println("Successfully wrote to the file.");
         } catch (IOException e) {
             System.out.println("An error occurred.");
             e.printStackTrace();}}
//
    private static void showMainMenu() throws IOException {
        System.out.println("1. Add person");
        System.out.println("2. Find person");
        System.out.println("3. Show all contacts");
        System.out.println("4. read file");
        System.out.println("5. write file");
        System.out.println("6. Close program");

        String choice;
        do {
            choice = in.nextLine();
            switch (choice) {
                case "1":
                    addPerson();
                    break;
                case "2":
                    findPerson();
                    break;
                case "3":
                    readPeopleFromFile();
                    break;
                case "4":
                    System.out.println(people);
                    System.out.println();
                    showMainMenu();
                    break;
                case "5":
                    System.exit(0);
                    break;
                case "6":
                    writePeopleFromFile();
                    break;
                default:
                    System.out.println("Enter number from 1 to 6");
            }
        }while(!choice.equals("6"));
    }}
